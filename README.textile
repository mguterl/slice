h1. Setup steps

The following step-by-step process outlines how to setup a Rails server on Slicehost using Debian 4.0 and Passenger.

h2. Add the deploy user

type @adduser deploy@

Command will ask you for a new password. Go ahead and choose one. You can safely choose default user information (blank).

Now you need to setup sudo for the deploy user.

type @visudo@

Add the following text to bottom of file:

@deploy ALL=(ALL) ALL@

You can confirm you got sudo setup properly by typing @cat /etc/sudoers@ and ensuring that the deploy line you added is at the bottom of the output

h2. SSH public key

You need to copy a SSH public key from your local machine to the server. You need to have created SSH key first.

type @scp ~/.ssh/id_dsa.pub deploy@XXX.XXX.XXX.XXX@ (replace X's with your slice IP) 

Add public key to authorized keys and set permissions

<pre><code>mkdir ~/.ssh
touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
cat ~/id_dsa.pub >> ~/.ssh/authorized_keys
rm ~/id_dsa.pub</code></pre>

h2. Configure the SSH daemon to be more secure
$ sudo -s (enter password when prompted)
# cp etc/ssh/sshd_config /etc/ssh/sshd_config
# /etc/init.d/ssh restart

6. Copy bash settings to your home directory
$ cat .bash_profile >> ~/.bash_profile
$ source ~/.bash_profile

7. update and upgrade installed packages
$ update
$ upgrade

8. Install and set locales
$ install locales
$ sudo dpkg-reconfigure locales

9. Install screen
$ install screen

10. Install build tools
$ install build-essential

11. Install and setup Shorewall (firewall)
$ install shorewall
# cp etc/shorewall/rules /etc/shorewall/rules
# cp etc/shorewall/zones /etc/shorewall/zones
# cp etc/shorewall/interfaces /etc/shorewall/interfaces
# cp etc/shorewall/policy /etc/shorewall/policy

12. You must enable shorewall by setting startup=1
# nano /etc/default/shorewall

h2. Ruby installation

For some reason I cannot get REE to install with their prebundled runtime, so install ruby is necessary.
@install ruby ruby1.8-dev irb ri rdoc libopenssl-ruby1.8 zlib1g-dev libssl-dev -y@

@install wget@
@mkdir -p ~/src@
@cd ~/src@

You probably want to refer to http://www.rubyenterpriseedition.com/download.html to get the latest version.

@wget http://rubyforge.org/frs/download.php/41040/ruby-enterprise-1.8.6-20080810.tar.gz@
@tar -xzvf ruby-enterprise-1.8.6-20080810.tar.gz@
@cd ruby-enterprise-1.8.6-20080810@

Run the installer and follow the directions.  

@./installer@

@remove irb irb1.8 libopenssl-ruby1.8 libreadline-ruby1.8 libruby1.8 rdoc rdoc1.8 ri ri1.8 ruby ruby1.8 ruby1.8-dev@

Edit your .bash_profile in order to put REE in the PATH
@nano ~/.bash_profile@

Add this line: 
@export PATH=$PATH:/opt/ruby-enterprise-1.8.6-20080810/bin@

To make the changes take effect
@source ~/.bash_profile@

=== Resources ===
* http://articles.slicehost.com/2007/9/5/debian-etch-setup-page-1
* http://articles.slicehost.com/2007/9/5/debian-etch-setup-page-2

