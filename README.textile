h1. Setup steps

The following step-by-step process outlines how to setup a Rails server on Slicehost using Debian 4.0 and Passenger.

h2. Install git

From remote server, type: 

<pre>sudo aptitude update
sudo aptitude upgrade
sudo aptitude install git-core</pre>

h2. Add the deploy user

type @adduser deploy@

Command will ask you for a new password. Go ahead and choose one. You can safely choose default user information (blank).

Now you need to setup sudo for the deploy user.

type @visudo@

Add the following text to bottom of file:

@deploy ALL=(ALL) ALL@

You can confirm you got sudo setup properly by typing @cat /etc/sudoers@ and ensuring that the deploy line you added is at the bottom of the output

h2. SSH public key

You need to copy a SSH public key from your local machine to the server. You need to have created SSH key first.

from your local computer, type @scp ~/.ssh/id_dsa.pub deploy@XXX.XXX.XXX.XXX:@ (replace X's with your slice IP, don't forget the trailing semi-colon) 

h3. Add public key to authorized keys and set permissions

Login to the slice using your new 'deploy' user, and enter the following commands:

<pre><code>mkdir ~/.ssh
touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
cat ~/id_dsa.pub >> ~/.ssh/authorized_keys
rm ~/id_dsa.pub</code></pre>

h2. Copy the setup files to remote server

Login as deploy user, and type: @git clone git://github.com/mguterl/slice.git@

h2. Configure the SSH daemon to be more secure

<pre><code>sudo -s (enter password when prompted)
cp slice/etc/ssh/sshd_config /etc/ssh/sshd_config
/etc/init.d/ssh restart</code></pre>

h2. Copy bash settings to your home directory

<pre><code>cat slice/.bash_profile >> ~/.bash_profile
source ~/.bash_profile</code></pre>

7. update and upgrade installed packages
$ update
$ upgrade

8. Install and set locales
$ install locales
$ sudo dpkg-reconfigure locales

9. Install screen
$ install screen

10. Install build tools
$ install build-essential

11. Install and setup Shorewall (firewall)
$ install shorewall
# cp etc/shorewall/rules /etc/shorewall/rules
# cp etc/shorewall/zones /etc/shorewall/zones
# cp etc/shorewall/interfaces /etc/shorewall/interfaces
# cp etc/shorewall/policy /etc/shorewall/policy

12. You must enable shorewall by setting startup=1
# nano /etc/default/shorewall

h2. Ruby installation

@install wget@
@mkdir -p ~/src@
@cd ~/src@

@wget ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.6-p111.tar.bz2@
@tar -jxvf ruby-1.8.6-p111.tar.bz2@
@cd ruby-1.8.6-p111@
@./configure --prefix=/usr/local --disable-pthread@
@make@
@sudo make install@

@cd ~/src@
@wget http://rubyforge.org/frs/download.php/45905/rubygems-1.3.1.tgz@
@tar -xzvf rubygems-1.3.1.tgz@
@cd rubygems-1.3.1@
@sudo ruby setup.rb@

h2. Apache installation

@install apache2 apache2-prefork-dev@

h2. Passenger installation

@sudo gem install rake passenger@
@sudo passenger-install-apache2-module@

h2. MySQL installation
@install mysql-server-5.0 libmysqlclient15-dev@
@sudo gem install mysql@

h2. Git installation
@install git-core@

=== Resources ===
* http://articles.slicehost.com/2007/9/5/debian-etch-setup-page-1
* http://articles.slicehost.com/2007/9/5/debian-etch-setup-page-2

